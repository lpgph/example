package io.lpgph.uaa.oauth2.config;

import io.lpgph.uaa.identity.security.filter.ResourceTestAuthenticationFilter;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.oauth2.config.annotation.web.configuration.EnableResourceServer;
import org.springframework.security.oauth2.config.annotation.web.configuration.ResourceServerConfigurerAdapter;
import org.springframework.security.web.authentication.www.BasicAuthenticationFilter;

/*
 * @see io.lpgph.uaa.identity.security.config.WebSecurityConfig
 **/
@Configuration
@EnableResourceServer
public class ResourceServerConfig extends ResourceServerConfigurerAdapter {


  @Override
  public void configure(HttpSecurity http) throws Exception {
    // "/userinfo" 属于资源保护的服务 需要通过 access_token 请求
    http.requestMatchers(matcher -> matcher.antMatchers("/userinfo"))
        .authorizeRequests(request -> request.anyRequest().authenticated());
    http.addFilterBefore(new ResourceTestAuthenticationFilter(), BasicAuthenticationFilter.class);
  }

}
